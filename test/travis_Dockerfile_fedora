ARG CONTAINER
ARG APR_VERSION
ARG APU_VERSION
ARG APR_CONFIG
ARG APU_CONFIG
FROM ${CONTAINER}
RUN yum -y install git gcc make autoconf automake libtool \
    subversion /usr/bin/python openssl-devel systemd-devel \
    zlib-devel brotli-devel lua-devel pcre2-devel libuuid-devel \
    libxml2-devel pkgconfig expat-devel perl-App-cpanminus \
    'perl(Net::SSL)' 'perl(LWP::Protocol::https)' 'perl(ExtUtils::Embed)' 'perl(Test::More)' 'perl(AnyEvent)' 'perl(DateTime)' 'perl(HTTP::DAV)' 'perl(Protocol::HTTP2::Client)' 'perl(FCGI)' 'perl(Apache::Test)' && \
    yum clean all
RUN useradd -l -m build
USER build
RUN mkdir /home/build/build
COPY ./ /home/build/build/httpd
WORKDIR /home/build/build/httpd
RUN ./test/travis_before_linux.sh
ENV APR_VERSION=$APR_VERSION
ENV APU_VERSION=$APU_VERSION
ENV BUILDCONFIG="--with-apr=/home/build/build/apr-$APR_VERSION --with-apr-util=/home/build/build/apr-util-$APU_VERSION"
